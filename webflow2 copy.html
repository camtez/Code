<script>

    var Webflow = Webflow || [];
    
    Webflow.push(function () {
      // DOMready has fired
      // May now use jQuery and Webflow API
      
      // prefill forms other info
      $("#formOtherNav").val("SU");
      $("#formOtherFooter").val("SU");
      
      // API calls
      
      var i = 0;
      var loadingIndex = 0;
      var x = "";
      var lastIdeaText = "";
      var lastExampleText = "";

      $("#subtitle").text(loadingIndex);

      function startLoadingAnimation(elementId, loadingTexts) {
        loadingIndex = 0;
        return setInterval(function() {
            loadingIndex = (loadingIndex + 1) % loadingTexts.length;
            $("#" + elementId).text(loadingTexts[loadingIndex]);
        }, 1000);
      }

      function getRandomIdeaText() {
        var randomExpression = ideaTexts[Math.floor(Math.random() * ideaTexts.length)];
        while (randomExpression === lastIdeaText) {
            randomExpression = ideaTexts[Math.floor(Math.random() * ideaTexts.length)];
        }
        lastIdeaText = randomExpression;
        console.log(randomExpression);
        return randomExpression;
      }

      function getRandomExampleText() {
        var randomExpression = exampleTexts[Math.floor(Math.random() * exampleTexts.length)];
        while (randomExpression === lastExampleText) {
            randomExpression = exampleTexts[Math.floor(Math.random() * exampleTexts.length)];
        }
        lastExampleText = randomExpression;
        console.log(randomExpression);
        return randomExpression;
      }

      function replaceText(apiMessage) {
        let tempMessage = apiMessage;
        
        tempMessage = tempMessage.split(/\n\n\n/).map(idea => idea.replace(/Feature idea:|Feature idea name:/g,getRandomIdeaText())).join('\n\n\n');
        tempMessage = tempMessage.split(/\n\n\n/).map(idea => idea.replace(/Example:|Example \(including how it works\):/gi,getRandomExampleText())).join('\n\n\n');
        tempMessage = tempMessage.replace(/\n/g, '<br>');
        return tempMessage;
      }

      function pipedreamSteve(x,i,outputElement,progressElement,nextQuestion,loadingInterval) {
        var webhook = 'https://eouv4h921hkuwbt.m.pipedream.net/?x=' + encodeURIComponent(x) + '&i=' + encodeURIComponent(i);
        fetch(webhook)
            .then(response => response.json())
            .then(data => {
              // On success, stop the loading texts and show the data
              clearInterval(loadingInterval);
              console.log(data);
              let formattedText = replaceText(data.result)
              $(outputElement).html(formattedText);
              $(progressElement).hide();
              $(nextQuestion).css("display", "flex");
              if (i === 0) {
                $('#continueReading').show();
              };
            })
            .catch(error => {
              // On error, stop the loading texts and show an error message
              clearInterval(loadingInterval);
              $(outputElement).text('Error: ' + error.toString());
              $(outputElement).css('color', '#DE3021');
              console.log('error');
            });
      }
    
      // Entering domain -> message0
      $('#enter').click(function() {
        i = 0;
        x = $("#domain").val().trim();
        $("#message0").css("display", "flex");
        setTimeout(() => {
            $("#filler0").css("width", "100%");
        }, 50);  // 50ms delay

        // Check if x is not empty
        if (x === '') {
            $("#output0").text('Please enter a domain');
            $("#output0").css('color', '#DE3021');
            console.log('x is empty')
            return; // Exit the function early
        }
    
        // Show loading text
        $("#output0").css('color', 'black');

        $("#question1").hide();
        $("#question2").hide();
        $("#question3").hide();
        $("#message1").hide();
        $("#message2").hide();
        $("#message3").hide();
    
        // Start the interval to cycle through the loading texts
        var loadingInterval = startLoadingAnimation("output0",loadingTexts0);
    
        // PREPARING DATA
    
        // If the input doesn't start with 'http://' or 'https://', add 'https://'
        if (!x.startsWith('http://www.') && !x.startsWith('https://www.')) {
            x = 'https://www.' + x;
        }

        if (x.startsWith('http://')) { // remove http
            x = x.substring(7);
        }
        if (x.startsWith('https://')) { // remove https
            x = x.substring(8);
        }
        if (!x.startsWith('www.')) { // add www.
            x = 'www.' + x;
        }
        x = 'https://' + x; // add https

        var matches = x.match(/https:\/\/[^/]+/);
        if (matches) { // Remove anything after '.com' or other domain extensions
            x = matches[0];
        }

        pipedreamSteve(x,i,'#output0','#progressBar0','#question1',loadingInterval);
      });
        
      // Continue reading first message
      $('#continueReading').click(function() {
        $('#continueReading').hide();
        $("#output0").css("max-height", "none");
      });

      // Subscribing to newsletter -> message1
      $('#subscribe').click(function() {
        i = 1;
        var email = $("#email").val().trim();
        $("#message1").css("display", "flex");
        setTimeout(() => {
            $("#filler1").css("width", "100%");
        }, 50);  // 50ms delay

        // Check if email is not empty
        if (email === '') {
            $("#output1").text('Please enter a valid email address');
            $("#output1").css('color', '#DE3021');
            console.log('email is empty')
            return; // Exit the function early
        };

        $("#output1").css('color', 'black');
        var loadingInterval = startLoadingAnimation("output1", loadingTexts1); // Loading text

        $("#newsletterText").text('Successfully signed up to the newsletter!');
        $('#emailInput').hide();

        // Start Make automation to collect email
        var webhook = 'https://hook.us1.make.com/pl17c96gsqf34sgimjjj1e7w6vqpmjnl/?email=' + encodeURIComponent(email) + '&x=' + encodeURIComponent(x) + '&other=' + encodeURIComponent('AI');
        console.log(webhook);  
        fetch(webhook);

        pipedreamSteve(x,i,'#output1','#progressBar1','#question2',loadingInterval);
      });

      function copyToClipboard(text) {
        var sampleTextarea = document.createElement("textarea");
        document.body.appendChild(sampleTextarea);
        sampleTextarea.value = text; //save main text in it
        sampleTextarea.select(); //select textarea contenrs
        document.execCommand("copy");
        document.body.removeChild(sampleTextarea);
      }
      
      // Sharing -> Message2
      function startShare() {

        // Save to clipboard
        copyToClipboard("Check this out: conversionexamples.com/ai")

        $("#question2v1").hide();
        $("#question2v2").css("display", "flex");

        $("#qtext2").css('color', 'black');

        // Reset the loading index
        loadingIndex = 0;
        var loadingInterval = startLoadingAnimation("qtext2", sharingTexts);

        // After 15 seconds, stop the loading texts and show the confirmation message
        setTimeout(function() {
            clearInterval(loadingInterval);
            $("#shareConfirm").show();
            $("#qtext2").text('We rely on an honesty system. Did you share the link?');
        }, 15000);
      }

      $('#share1').click(startShare)
      $('#share2').click(function() { // Linkedin
        startShare();
        const linkedinURL = 'https://www.linkedin.com/feed/?shareActive&mini=true&text=' + encodeURIComponent('Insanely great, as Steve would say. Check this out if you make products: conversionexamples.com/ai');
        window.open(linkedinURL, '_blank');
      });
      $('#share3').click(function() { // Twitter
        startShare();
        const twitterURL = 'http://twitter.com/share?url=' + encodeURIComponent('Can AI think different? Try for yourself: conversionexamples.com/ai');
        window.open(twitterURL, '_blank');
      });
      $('#share4').click(startShare) // Copy to clipboard

      // Share confirm
      $('#shareConfirm').click(function() {
        i = 2;

        $("#message2").css("display", "flex");
        setTimeout(() => {
            $("#filler2").css("width", "100%");
        }, 50);  // 50ms delay
        $("#qtext2").text('Successfully shared!');
        $('#shareConfirm').hide();

        var loadingInterval = startLoadingAnimation("output2", loadingTexts2);

        pipedreamSteve(x,i,'#output2','#progressBar2','#question3',loadingInterval);

        // prep Stripe link
        var webhook = 'https://eolmnwc1sqa2h6o.m.pipedream.net/?url=' + encodeURIComponent(x);
          fetch(webhook)
            .then(response => response.json())
            .then(data => {
              console.log(data.result);
              let url = data.result;
              $("#getMore").attr("href", url); // set #getMore link to returned value
            })
            .catch(error => {
              // On error, stop the loading texts and show an error message
              clearInterval(loadingInterval);
              $(outputElement).text('Error: ' + error.toString());
              $(outputElement).css('color', '#DE3021');
              console.log('error');
            });

      });
      
      // Get 99 ideas
      $('#getMore').click(function() {
        $("#message3").css("display", "flex");
      });
    
    });
    
    </script>